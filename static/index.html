<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>TorrentDownloader</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
</head>
<body id="page1">

	<div class="Inputs">
		<form action="/" id="downloadForm">
			<input type="text" name="taskName" placeholder="Task Name">
			<input type="text" name="torrentURL" placeholder="Torrent URL">
			<input type="text" name="subtitleURL" placeholder="Subtitle URL">
			</br>
			</br>
			<input type="submit" value="Download!">
		</form>
	</div>

	<div class="DownloadingNow">
		<p>Downloading Now:</p>
		<!-- TODO: enable stop/resume -->
		<ol id="DownloadingNowList">
		</ol>
	</div>

	<div class="DownloadedList">
		<p>Downloaded List:</p>
		<!-- TODO: enable delete -->
		<ol id="DownloadedList">
		</ol>
	</div>

	<script>
		// Attach a submit handler to the form
		$("#downloadForm")
				.submit(
						function(event) {

							// Stop form from submitting normally
							event.preventDefault();

							// Get some values from elements on the page:
							var $form = $(this), taskName = $form.find(
									"input[name='taskName']").val(), torrentURL = $form
									.find("input[name='torrentURL']").val(), subtitleURL = $form
									.find("input[name='subtitleURL']").val();

							var obj = {
								"taskName" : taskName,
								"torrentURL" : torrentURL,
								"subtitleURL" : subtitleURL
							};

							$.ajax({
								type : "POST",
								url : 'http://localhost:1402/downloadTorrent',
								contentType : 'application/json',
								async : false,
								data : JSON.stringify(obj),
								success : function() {
									alert("Downloading!");
								}
							})

						});

		var interval = 1000;
		function doGetDownloadingList() {
			$.ajax({
				type : 'GET',
				url : 'http://localhost:1402/downloadingNow',
				accept : 'application/json',
				success : function(data) {
					$("#DownloadingNowList").empty();
					for (var i = 0; i < data.length; i++) {
						var li = document.createElement("li");
						li.appendChild(document
								.createTextNode(data[i].taskName));
						$("#DownloadingNowList").append(li);
					}
				},
				complete : function(data) {
					// Schedule the next
					setTimeout(doGetDownloadingList, interval);
				}
			});
		}
		setTimeout(doGetDownloadingList, interval);
	</script>

</body>
</html>
